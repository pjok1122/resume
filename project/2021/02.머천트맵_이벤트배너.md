## Merchant Map 상세 페이지 개편 Phase 2

### 기획

- 대만에서 사용하는 광고 플랫폼을 머천트맵에서도 보여주어야 한다.
- ETC Promotion : 가맹점 단위의 프로모션이 아니라, 점포 단위의 프로모션 진행이 가능해야 한다.
- Event : 프로모션과 별개로 점포 단위의 이벤트도 진행이 가능해야 한다. (이미지 포함)
- ETC Promotion과 Event는 LPA에서 등록이 가능해야 한다.
- ETC Promotion과 Event는 Merchant map에서 보여지며, 프랜차이즈로 묶여있는 경우 프랜차이즈에서 진행하는 프로모션/이벤트가 더 상단에 노출된다.

- 프로모션/이벤트는 게시기간이 있으며, 특정 게시기간 동안만 노출되어야 한다.

### 일정

- 개발 기간 : 21.01.04 ~ 21.02.01
- 투입 인력 : 1인
- BETA QA : 02.08 ~ 02.16
- RC QA : 02.16 ~ 2.18
- Release : 2021.02.25 배포

### 개발

- store_promotion, store_event 컬렉션 구축.
- 이미지 업로드를 위한 OBS 이미지 업로드 환경 구축.
- 광고 API를 프론트에서 직접 호출하는 것이 불가하여, 머천트맵 Server에서 Proxy.
- (API) : 진행 중인 프로모션,이벤트를 Caching(5분)하여 성능 최적화. (최대 5분동안 이벤트 기간이 아닌 프로모션/이벤트를 내려줄 수 있으나, Front에서 한 번 더 검증하여 노출)
- (Front/Back Admin) : ETC Promotion/Event를 등록/수정/삭제 할 수 있는 기능을 LPA에 구현. Vue.js를 사용. (i18n을 이용한 다국어 처리.)
- (Batch) : 매일 기간이 만료된 이벤트/프로모션의 on/off 타입을 off로 변경.

<hr>

### 회고

#### 두근두근 첫 설계 리뷰

이번 프로젝트는 설계부터 개발까지 직접 진행하게 됐다. 벌써 이런 업무를 해도 되는 걸까? 라는 생각이 들긴 했지만, 팀원이 나를 믿어주는 거라고 긍정적으로 생각하기로 했다. 그래서 기대에 부응하고 싶었지만 설계도 익숙치 않고 설계 리뷰는 또 어떻게 하는건지 도무지 감이 오질 않았다. 그래서 팀원 분들이 작성한 설계 리뷰 문서를 참고해, 다이어그램도 그리고 DB schema도 설계하고, 개발 시에 걱정이 되는 부분에 대해서 나의 생각을 정리했다. 문서를 쓰는 과정은 지루하고, 개발 전에 설계를 한다는 과정이 추상적이기 때문에 쉽지만은 않았다. 하지만, 설계리뷰를 준비하면서 설계가 더 견고해지는 걸 몸소 느낄 수 있었고, 선배 개발자님들의 조언을 들어볼 수 있는 좋은 기회였다. 하지만 리뷰를 하는 내내 내가 틀렸을까 위축되는 내 자신을 볼 수 있었다. 딱히 혼나는 것도 아닌데 말이다. 아직까진 팀원의 유대감보다는 직장 상사라는 느낌이 강하긴 한 것 같다.

<br>

#### 솔플로 빠른 레벨업

보통 과제는 최소 2명이 개발에 참여해야 한다고 들었는데, 어쩌다보니 이 과제는 나 혼자 설계하고 개발하게 됐다. 개발을 혼자한다는 사실은 다소 부담이 됐다. 사실상 코드 리뷰는 형식적으로 이루어졌고, 코드에 대한 검증은 온전히 내 책임이 되는 것 같았다. '혹시라도 기한을 못 채우면 어떡하지?' '장애가 나면 나밖에 코드를 모르는데 대응은 어떡하지?' 이런 별의 별 생각이 다 들었다. 다행이도 적당한 긴장감을 유지한 채 개발을 진행해서인지 우려했던 일은 일어나지 않았지만, 라인은 신입 개발자를 정말 강하게 키운다는 생각이 든다..

이런 기회가 있었기에 설계, 개발, 커뮤니케이션 등 모든 분야에서 폭풍 성장을 할 수 있었고, 1년차임에도 불구하고 경력직처럼 보일 수 있었던 것 같다. 

<br>

#### 개발 시간이 모자라

기진님이 다른 과제로 involve되면서 나 혼자 이 과제를 수행해야 하게 됐다. 게다가 1월에 개발한 Kuji admin의 QA 기간과 이 과제의 개발 기간이 겹쳐, 상당한 context switching을 경험하면서 일 했다. 사업 쪽에서는 2월에 배포가 되길 원했지만, 어쩔 수 없이 벌크성 기능과 미리보기 기능에 대해서는 양해를 구하고 3월 배포로 진행하기로 했다. 배포 까지 2달이 남았어도 **QA 기간 때문에 한 달은 일찍 개발이 마무리 되어야 하고, 다른 과제의 QA 기간동안 개발을 해야 한다면 실제 개발 시간은 예상보다 훨씬 적을 수 있다는 걸 알게 됐다.** 다음에는 공수 산정을 할 때 이 부분을 참고해서 산정해야겠다.

<br>

#### OBS 연동

지난 과제들로 Central dogma, VOS는 사용해봤는데 이번엔 또 새로운 인프라인 OBS가 등장했다. 혼자 해결해야 하다보니 가이드문서를 꼼꼼하게 읽고, 2일 간의 삽질 끝에 로컬과 베타 환경에서 사용할 수 있게 만들었고, 어떻게 연동하는지 wiki 문서도 작성했다. 하지만, 나는 이땐 몰랐다. OBS를 rc, real에서 쓰기 위해서는 한참 일찍부터 신청 해야 한다는 것을...

뒤늦게 알게되어 beta QA 끝물에 rc와 real을 급하게 신청하게 됐다. 원래 2주 가량 시간이 소요되는데, OBS 팀에 사정사정해서 RC QA에 늦지 않게 반영할 수는 있었다. 내 입장에선 다행이지만 의도치않게 다른 팀의 일정을 내가 망친 것 같아 조금은 미안했다. **rc, real에서 뭔가를 사용하려면 꼭 beta QA 시작할 때 쯤엔 신청해야겠다.**

<br>

#### Vue 개발

머천트맵은 Admin 화면에 Vue.js가 사용된다. 이전에 Vue에 대해서 공부해본 적이 있어 크게 어려움을 겪진 않았다. 팀 내에서 Vue를 사용할 수 있는 사람이 없고 나만이 사용할 줄 알아서 조금은 특별한 기분이 들었다. Vue.js로 작업하는 건 좋으나 기존 소스코드가 제법 정리가 안되어있다. 다국어 처리 기능이 존재하지 않아서 i18n 라이브러리를 붙였고, 일부 정돈되지 않은 코드들도 정리했다. 아직 개선하고 싶은 부분이 많이 있지만, 개발 일정에 차질이 생길 것 같은 부분은 과감하게 스킵했다. 

기존에 개발되어있는 다른 페이지들과 내가 만든 페이지를 비교했을 때 퀄리티가 더 좋게 나온 것 같아서 뿌듯하다. 시간이 된다면 나머지 페이지도 수정하고 싶다. (그렇다고 프론트로 전향하고 싶진 않다..)

<br>

#### 맛보기 완료

이벤트와 ETC 프로모션의 상태를 매일 한 번씩 변경시켜주는 기능이 필요해 배치 쪽에도 작업을 진행하게 됐다. Spring batch와 Jenkins를 처음 사용하게 됐다. 말로만 들어보고 한 번도 사용해본 적은 없었으나, 이미 세팅이 되어있는 코드에 Job 하나 추가하는 것은 지식이 없어도 별로 어려운 일은 아니었다. 하지만 명확한 동작을 알 수 없으니 시간될 때 Spring batch에 대해서 이해하고 정리해야겠다. 

아무튼, 이번 과제를 진행함으로써 머천트맵 모든 서버에 발을 담궈본 셈이 됐다. 새로운 기술과 도전이 많은 과제였지만, 겁내지 않고 성실히 임하다보니 잘 끝날 수 있었던 것 같다. 나도 이제 어느정도 라인페이에 적응한 걸까? (김칫국..)